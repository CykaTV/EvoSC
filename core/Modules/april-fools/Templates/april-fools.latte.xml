<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<manialink name="ESC:april-fools-kill-switch" id="april-fools-kill-switch" version="3">
    <frame id="frame" size="30 18" pos="120 -100" z-index="999999">
        <label class="disable" pos="15 -9" valign="center" halign="center" textsize="0.75" text="DISABLE APRIL FOOLS MADNESS" size="22 10" autonewline="1" ScriptEvents="1" textfont="{config('colors.ui.font')|noescape}" focusareacolor1="{config('colors.ui.widget.header.color')}c" focusareacolor2="000c" z-index="1" />

        <frame id="arrows">
            <label textcolor="0000" pos="17 -2" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="14 -2" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="11 -2" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="8 -2" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="5 -2" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="2 -5" rot="-90" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="2 -8" rot="-90" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="2 -11" rot="-90" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="2 -14" rot="-90" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="5 -16" rot="-180" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="8 -16" rot="-180" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="11 -16" rot="-180" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="14 -16" rot="-180" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="17 -16" rot="-180" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="20 -16" rot="-180" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="23 -16" rot="-180" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="26 -16" rot="-180" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="28 -14" rot="90" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="28 -11" rot="90" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="28 -8" rot="90" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="28 -5" rot="90" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="26 -2" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="23 -2" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
            <label textcolor="0000" pos="20 -2" valign="center" halign="center" textsize="2" text="" size="3 3" autonewline="1" z-index="2" />
        </frame>
    </frame>

    <script><!--
#Include "MathLib" as ML
#Include "TextLib" as TL

declare Real width;
declare Real height;
declare Vec3 colorPrimary;
declare Vec3 colorSecondary;
declare Integer duration;

Void reposition(CMlFrame frame){
    declare x = ML::Rand(-160.0, 160.0);
    declare y = ML::Rand(-90.0, 90.0);
    if(x > 160.0 - width * 3){
        x = 160.0 - width * 3;
    }
    if(y > 90.0 - height * 3){
        y = 90.0 - height * 3;
    }
    if(x < -160.0 + width * 3){
        x = -160.0 + width * 3;
    }
    if(y < -90.0 + height * 3){
        y = -90.0 + height * 3;
    }

    AnimMgr.Add(frame, "<frame pos='" ^ x ^ " " ^ y ^ "' />", duration, CAnimManager::EAnimManagerEasing::ExpOut);
}

Void start(CMlFrame frame){
    AnimMgr.Add(frame, "<frame pos='120 -60' />", 2000, CAnimManager::EAnimManagerEasing::ExpOut);
}

main() {
    declare Integer LastUiUpdate for This = 0;
    declare Boolean AprilMadness for This = True;
    declare frame <=> (Page.MainFrame.GetFirstChild("frame") as CMlFrame);
    declare arrowsFrame <=> (Page.MainFrame.GetFirstChild("arrows") as CMlFrame);
    declare i = 0;
    declare update = 0;
    declare visible = False;

    colorPrimary = TL::ToColor("{config('colors.ui.widget.header.color')|noescape}");
    colorSecondary = colorSecondary;
    duration = 1000;

    width = frame.Size[0];
    height = frame.Size[1];
    AprilMadness = True;

    while(True){
        yield;

        if(!visible){
            if(InputPlayer == Null){
                continue;
            }
            wait(InputPlayer.DisplaySpeed > 50);
            visible = True;
            start(frame);
        }

        foreach(Event in PendingEvents){
            if(Event.Control == Null) continue;
            if(Event.Control.HasClass("disable") && Event.Type == CMlScriptEvent::Type::MouseOver){
                duration *= 2;
                frame.Scale -= 0.05;
                if(frame.Scale < 0.5){
                    frame.Scale = 0.5;
                }
                reposition(frame);
            }
            if(Event.Control.HasClass("disable") && Event.Type == CMlScriptEvent::Type::MouseClick){
                frame.Hide();
                AprilMadness = False;
                LastUiUpdate = GameTime;
                return;
            }
        }

        if(update % 3 == 0){
            if(i == 0){
                (arrowsFrame.Controls[arrowsFrame.Controls.count - 1] as CMlLabel).TextColor = colorSecondary;
            }else{
                (arrowsFrame.Controls[i - 1] as CMlLabel).TextColor = colorSecondary;
            }
            (arrowsFrame.Controls[i] as CMlLabel).TextColor = colorPrimary;

            declare opposite = i + (arrowsFrame.Controls.count / 2);
            if(opposite >= arrowsFrame.Controls.count){
                opposite -= arrowsFrame.Controls.count;
            }
            declare oppositeI = opposite;
            if(oppositeI == 0){
                (arrowsFrame.Controls[arrowsFrame.Controls.count - 1] as CMlLabel).TextColor = colorSecondary;
            }else{
                (arrowsFrame.Controls[oppositeI - 1] as CMlLabel).TextColor = colorSecondary;
            }
            (arrowsFrame.Controls[opposite] as CMlLabel).TextColor = colorPrimary;

            i += 1;
            if(i >= arrowsFrame.Controls.count){
                i = 0;
            }
        }

        update += 1;
        if(update > 9){
            update = 0;
        }
    }
}
    --></script>
</manialink>