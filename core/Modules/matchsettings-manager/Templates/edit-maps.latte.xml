{contentType text}
{extends 'components.tabbed-window'}
{php $window_height = 89;}
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<manialink id="{block id}edit-settings{/block}" version="3">
    {block icon}{/block}
    {block title}Edit {$name}{/block}

    {block navbar}
        {include 'components.tabs', tabs =>
            [
                'Settings'=>'msm.edit,'.$name,
                'Maps'=>''
            ]
        }
    {/block}

    {block content}
    <frame pos="0 -7.5">
        <label size="35 4" textsize="0.3" text="Name" valign="center" textprefix="$o" textcolor="{config('colors.ui.window.header.color')}" />
        <label pos="37" size="20 4" textsize="0.3" text="Author" valign="center" textprefix="$o" textcolor="{config('colors.ui.window.header.color')}" />
        <label pos="59" size="30 4" textsize="0.3" text="Environment(Title)" valign="center" textprefix="$o" textcolor="{config('colors.ui.window.header.color')}" />
        <label pos="91" size="30 4" textsize="0.3" text="Played" valign="center" textprefix="$o" textcolor="{config('colors.ui.window.header.color')}" />
    </frame>

    {foreach $chunks as $chunkN => $maps}
    <frame pos="0 -11.5" hidden="{$iterator->counter > 1 ? 1 : 0}">
        {foreach $maps as $i => $map}
        <frame class="map" pos="0 {$i * -3.5}" data-id="{$map->id}" data-enabled="{$map->enabled}">
            <label pos="113" size="3 3" textsize="0.9" text="{$map->enabled ? '$fff' : '$333'}" valign="center" />
            <label size="34 3" textsize="0.6" text="{$map->name}" valign="center" />
            <label pos="37" size="20 3" textsize="0.6" text="{$map->author->name}" valign="center" />
            <label pos="59" size="30 3" textsize="0.6" text="{$map->environment ?? 'n/a'}({$map->title_id ?? 'n/a'})" valign="center" />
            <label pos="91" size="30 3" textsize="0.6" text="{$map->plays}" valign="center" />
            <label class="toggle" pos="-2" size="120 3.5" valign="center" ScriptEvents="1" z-index="-1" focusareacolor1="0000" focusareacolor2="{config('colors.ui.window.header.color')}9" />
        </frame>
        {/foreach}
    </frame>
    {/foreach}

    <frame id="pagination" pos="2 -80" scale="0.9">
        <entry id="page-input" class="page-input" pos="6 0" size="8 3.5" valign="center" halign="center"
               text="1" textsize="0.8" focusareacolor1="0000" focusareacolor2="0009" ScriptEvents="1" textcolor="{config('colors.ui.window.text.primary')}"
               hidden="1"/>
        <label id="page-info" class="enable-page-input" pos="6 0" size="8 3.5" valign="center"
               halign="center" text="1/{count($chunks)}" textsize="0.8" focusareacolor1="0000" focusareacolor2="0009" textcolor="{config('colors.ui.window.text.primary')}"
               ScriptEvents="1"/>
        <label class="previous-page" pos="0 0" size="3.5 3.5" valign="center" halign="center" text="⏴"
               textsize="1" ScriptEvents="1" focusareacolor1="{config('colors.ui.window.header.color')}3" textcolor="{config('colors.ui.window.text.primary')}"
               focusareacolor2="{config('colors.ui.window.header.color')}c"/>
        <label class="next-page" pos="12 0" size="3.5 3.5" valign="center" halign="center" text="⏵"
               textsize="1" ScriptEvents="1" focusareacolor1="{config('colors.ui.window.header.color')}3" textcolor="{config('colors.ui.window.text.primary')}"
               focusareacolor2="{config('colors.ui.window.header.color')}c"/>
    </frame>

    <frame id="search-frame" pos="89 -80" scale="0.9">
        <label textfont="{config('colors.ui.font')|noescape}" pos="30 0" halign="right" valign="center" textsize="0.9" text="🔍" textcolor="{config('colors.ui.window.text.primary')}"/>
        <entry textfont="{config('colors.ui.font')|noescape}" id="search-input" class="search-input" pos="26.5 0" size="25 3.5" textcolor="{config('colors.ui.window.text.primary')}"
               halign="right" valign="center" style="TextValueSmall" default="" textsize="1.2"/>
        <label textfont="{config('colors.ui.font')|noescape}" id="clear-search" class="clear-search" pos="0 0" size="3.5 3.5" textcolor="{config('colors.ui.window.text.primary')}"
               halign="center" valign="center" textsize="0.25" text="" focusareacolor1="f003"
               focusareacolor2="f009" ScriptEvents="1" hidden="1"/>
    </frame>
    {/block}

    {block scriptDeclarations}
    <script><!--
    declare Integer currentPage;
    --></script>
    {/block}

    {block functions}
    {/block}

    <script><!--

    {block bootScript}
    currentPage = 0;
    {/block}

    {block pendingEvents}
        if(event.Control.HasClass("toggle") && event.Type == CMlScriptEvent::Type::MouseClick){
            declare parent = event.Control.Parent;
            declare enabled = parent.DataAttributeGet("enabled") != "";
            declare mapId = parent.DataAttributeGet("id");

            if(enabled){
                (event.Control.Parent.Controls[0] as CMlLabel).SetText("$333");
                parent.DataAttributeSet("enabled", "");
                TriggerPageAction("msm.remove_map,{$name}," ^ mapId);
            }else{
                (event.Control.Parent.Controls[0] as CMlLabel).SetText("$fff");
                parent.DataAttributeSet("enabled", "1");
                TriggerPageAction("msm.add_map,{$name}," ^ mapId);
            }
        }

        if(event.Control.HasClass("icon") && event.Type == CMlScriptEvent::Type::MouseClick){
            window.Hide();
            TriggerPageAction("msm.overview");
            return;
        }
    {/block}
    --></script>
</manialink>